# =============================================================================
# Tmux Configuration - Swedish Keyboard Layout (jklö navigation)
# =============================================================================

# -----------------------------------------------------------------------------
# General Settings
# -----------------------------------------------------------------------------

set -g base-index 1           # Start window numbering at 1
set -g pane-base-index 1      # Start pane numbering at 1
set -g renumber-windows on    # Renumber windows when one is closed
set -g history-limit 10000
set -s escape-time 0          # No delay for escape key (important for vim)
set -g focus-events on        # Pass focus events to applications (vim integration)
set -g display-time 2000      # Display messages for 2 seconds
set -g mouse on
set-option -g allow-rename off

# -----------------------------------------------------------------------------
# Terminal and Colors
# -----------------------------------------------------------------------------

set -g default-terminal "tmux-256color"
set -ag terminal-overrides ",xterm-256color:RGB"

# -----------------------------------------------------------------------------
# Prefix and Config Reload
# -----------------------------------------------------------------------------

set -g prefix C-b

unbind r
bind r source-file ~/.tmux.conf \; display-message "Config reloaded!"

# -----------------------------------------------------------------------------
# Window Navigation
# -----------------------------------------------------------------------------

bind -n M-n next-window
bind -n M-p previous-window

# -----------------------------------------------------------------------------
# Pane Navigation - Swedish Keyboard Layout (vim-tmux-navigator compatible)
# Layout: j=left, k=down, l=up, ö=right
# -----------------------------------------------------------------------------

# Detect if we're in a vim process
is_vim="ps -o state= -o comm= -t '#{pane_tty}' \
    | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"

# Alt + jklö for pane switching (passes through to vim when in vim)
bind-key -n 'M-j' if-shell "$is_vim" 'send-keys M-j' 'select-pane -L'
bind-key -n 'M-k' if-shell "$is_vim" 'send-keys M-k' 'select-pane -D'
bind-key -n 'M-l' if-shell "$is_vim" 'send-keys M-l' 'select-pane -U'
bind-key -n 'M-ö' if-shell "$is_vim" 'send-keys M-ö' 'select-pane -R'

# Additional vim-tmux-navigator bindings
bind-key -n 'C-\' if-shell "$is_vim" 'send-keys C-\\' 'select-pane -l'
bind-key -n 'C-Space' if-shell "$is_vim" 'send-keys C-Space' 'select-pane -t:.+'

# -----------------------------------------------------------------------------
# Pane Resizing - Ctrl+Alt + jklh
# Note: Ctrl+Alt+ö doesn't work reliably in most terminals
# -----------------------------------------------------------------------------

bind -n C-M-j resize-pane -L 2
bind -n C-M-k resize-pane -D 2
bind -n C-M-l resize-pane -U 2
bind -n C-M-h resize-pane -R 2

# -----------------------------------------------------------------------------
# Copy Mode (vi) - Swedish Keyboard Navigation
# This also affects choose-tree (prefix + w) navigation!
# Layout: j=left, k=down, l=up, ö=right
# -----------------------------------------------------------------------------

set-window-option -g mode-keys vi

# Swedish keyboard cursor movement in copy/tree mode
bind-key -T copy-mode-vi j send-keys -X cursor-left
bind-key -T copy-mode-vi k send-keys -X cursor-down
bind-key -T copy-mode-vi l send-keys -X cursor-up
bind-key -T copy-mode-vi 'ö' send-keys -X cursor-right

# Page scrolling with Ctrl+u/d (vim-like half-page)
bind-key -T copy-mode-vi C-u send-keys -X halfpage-up
bind-key -T copy-mode-vi C-d send-keys -X halfpage-down

# Selection and yank
bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi y send-keys -X copy-selection

# Pane switching in copy mode (Alt + jklö)
bind-key -T copy-mode-vi 'M-j' select-pane -L
bind-key -T copy-mode-vi 'M-k' select-pane -D
bind-key -T copy-mode-vi 'M-l' select-pane -U
bind-key -T copy-mode-vi 'M-ö' select-pane -R
bind-key -T copy-mode-vi 'M-\' select-pane -l
bind-key -T copy-mode-vi 'C-Space' select-pane -t:.+

# -----------------------------------------------------------------------------
# Popup Utilities
# -----------------------------------------------------------------------------

bind-key -n C-g display-popup -E -T "Session Switcher" -w 90% -h 70% "~/.config/zsh/tmux-session-switcher.sh"
bind-key -n C-f display-popup -E -T "Workspace Finder" -w 90% -h 70% "~/.config/zsh/tmux-sessionizer.sh"
bind-key -n M-f display-popup -E -T "Terminal" -w 90% -h 70%

# -----------------------------------------------------------------------------
# Plugins
# -----------------------------------------------------------------------------

set -g @plugin 'tmux-plugins/tpm'

# Dracula theme
set -g @plugin 'dracula/tmux'

# Dracula settings
set -g @dracula-plugins "time"
set -g @dracula-time-format "%F %R"
set -g @dracula-military-time true
set -g @dracula-show-powerline true
set -g @dracula-show-fahrenheit false
set -g @dracula-show-flags true
set -g @dracula-show-left-icon session
set -g @dracula-show-empty-plugins false

# -----------------------------------------------------------------------------
# Plugin Manager (must be at the end)
# -----------------------------------------------------------------------------

run '~/.tmux/plugins/tpm/tpm'
